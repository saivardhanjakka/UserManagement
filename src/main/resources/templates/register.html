<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Register Here</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="container mt-5">
    <h2 class="text-danger">Register Here</h2>
    <form th:action="@{/register}" th:object="${user}" method="post" class="mt-3">
        <div th:if="${emsg}" class="alert alert-danger" th:text="${emsg}"></div>
        <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>
        <div class="mb-3">
            <label>Name:</label>
            <input type="text" th:field="*{name}" class="form-control" required/>
        </div>
        <div class="mb-3">
            <label>Email:</label>
            <input type="email" th:field="*{email}" class="form-control" required/>
        </div>
        <div class="mb-3">
            <label>Phone:</label>
            <input type="text" th:field="*{phone}" class="form-control" required/>
        </div>
        <div class="mb-3">
            <label>Country:</label>
            <select th:field="*{countryId}" class="form-select" id="country" required>
                <option value="">-Select-</option>
                <option th:each="entry : ${countries}" th:value="${entry.key}" th:text="${entry.value}"></option>
            </select>
        </div>
        <div class="mb-3">
            <label>State:</label>
            <select th:field="*{stateId}" class="form-select" id="state" required>
                <option value="">-Select-</option>
            </select>
        </div>
        <div class="mb-3">
            <label>City:</label>
            <select th:field="*{cityId}" class="form-select" id="city" required>
                <option value="">-Select-</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Sign-Up</button>
        <div class="mt-2">
            Do You Have Account? <a th:href="@{/}">Sign-In Here</a>
        </div>
    </form>

    <script>
        // Load States on Country change
        $('#country').on('change', function() {
            var countryId = $(this).val();
            $('#state').empty().append('<option value="">-Select-</option>');
            $('#city').empty().append('<option value="">-Select-</option>');
            if (countryId) {
                $.get('/states', {countryId: countryId}, function(states) {
                    $.each(states, function(key, value) {
                        $('#state').append('<option value="'+key+'">'+value+'</option>');
                    });
                });
            }
        });

        // Load Cities on State change
        $('#state').on('change', function() {
            var stateId = $(this).val();
            $('#city').empty().append('<option value="">-Select-</option>');
            if (stateId) {
                $.get('/cities', {stateId: stateId}, function(cities) {
                    $.each(cities, function(key, value) {
                        $('#city').append('<option value="'+key+'">'+value+'</option>');
                    });
                });
            }
        });
    </script>
</body>
</html>
